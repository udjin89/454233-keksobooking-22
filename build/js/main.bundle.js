(()=>{"use strict";const e={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},t=document.querySelector("#card").content.querySelector(".popup"),r=document.createDocumentFragment(),n=e=>{const t=document.createElement("div");t.style.cssText="z-index: 1000; position: absolute; display: inline; min-width: 500px; width: min-content; whitespace: pre-line; left: 50%; transform: translate(-50%, 0); top: 150px; right: 0; padding: 10px 5px; fontSize: 30px; text-align: center; border: 10px solid red; border-radius: 10px; background-color: white; ",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),3e3)},o=document.querySelector("main"),c=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),a=c.querySelector(".success__message"),s=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),i=s.querySelector(".success__message");let u;function d(e){"Escape"!==e.key&&"Esc"!==e.key||(e.preventDefault(),f())}function l(){f()}function f(){u.remove(),window.removeEventListener("keydown",d),window.removeEventListener("click",l)}function p(e,t){switch(e){case"success":c.style.zIndex="1000",t&&(a.textContent=t),u=o.appendChild(c),window.addEventListener("keydown",d),window.addEventListener("click",l);break;case"error":s.style.zIndex="1000",t&&(i.textContent=t),u=o.appendChild(s),window.addEventListener("keydown",d),window.addEventListener("click",l);break;default:throw new Error("Неизвестный тип сообщения!")}}const h=document.querySelector(".ad-form"),m=h.querySelectorAll("fieldset"),y=document.querySelector(".map__filters"),g=y.querySelectorAll(".map__filter"),v=y.querySelector(".map__features");function S(e){e.disabled=!0}function q(e){e.disabled=!1}let k,w=[];const E={lat:35.6895,lng:139.69171},x=L.icon({iconUrl:"./img/main-pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),b=L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),C=L.marker(E,{draggable:!0,icon:x});function T(n){n.forEach((n=>{const o=L.marker({lat:n.location.lat,lng:n.location.lng},{icon:b});w.push(o),o.addTo(k),o.addEventListener("click",(()=>function(n,o){const c=function(n){const o=t.cloneNode(!0),c=o.querySelector(".popup__title");n.offer.title?c.textContent=n.offer.title:c.classList.add("hidden");const a=o.querySelector(".popup__text--address");n.offer.address?a.textContent=n.offer.address:a.classList.add("hidden");const s=o.querySelector(".popup__text--price");n.offer.price?s.textContent=n.offer.price+" ₽/ночь":s.classList.add("hidden");const i=o.querySelector(".popup__type");n.offer.type?i.textContent=e[n.offer.type]:i.classList.add("hidden");const u=o.querySelector(".popup__text--capacity");n.offer.rooms&&n.offer.guests?u.textContent=n.offer.rooms+" комнаты для "+n.offer.guests+" гостей":u.classList.add("hidden");const d=o.querySelector(".popup__text--time");n.offer.checkin&&n.offer.checkout?d.textContent="Заезд после "+n.offer.checkin+" выезд до "+n.offer.checkout:u.classList.add("hidden");const l=o.querySelector(".popup__features");l.innerHTML="",n.offer.features[0]?n.offer.features.forEach((e=>{const t=document.createElement("li");t.classList.add("popup__feature",`popup__feature--${e}`),l.appendChild(t)})):l.classList.add("hidden");const f=o.querySelector(".popup__description");n.offer.description?f.textContent=n.offer.description:f.classList.add("hidden");const p=o.querySelector(".popup__photos"),h=p.querySelector(".popup__photo");p.removeChild(h),n.offer.photos[0]?n.offer.photos.forEach((e=>{const t=h.cloneNode(!0);p.appendChild(t),t.src=e})):p.classList.add("hidden");const m=o.querySelector(".popup__avatar");return n.author.avatar?m.src=n.author.avatar:m.classList.add("hidden"),r.appendChild(o)}(n);o.bindPopup(c)}(n,o)))}))}function A(){C.setLatLng(E),de(E)}C.on("move",(e=>{de(e.target.getLatLng())}));const F=["gif","jpg","jpeg","png"],M=document.querySelector(".ad-form__field input[type=file]"),z=document.querySelector(".avatar-image");M.addEventListener("change",(()=>{const e=M.files[0],t=e.name.toLowerCase();if(F.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{z.src=t.result})),t.readAsDataURL(e)}}));const D=document.querySelector(".ad-form__upload input[type=file]"),N=document.querySelector(".ad-form__photo");function $(){const e=N.querySelector("img");e&&N.removeChild(e),z.src="http://localhost:3000/img/muffin-grey.svg"}D.addEventListener("change",(()=>{const e=D.files[0],t=e.name.toLowerCase();if(F.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{const e=document.createElement("img");N.appendChild(e),e.src=t.result})),t.readAsDataURL(e)}}));const j=10,R={low:{min:0,max:1e4},middle:{min:1e4,max:5e4},high:{min:5e4,max:1/0}},U=document.querySelector(".map__filters-container"),V=U.querySelectorAll(".map__filter"),I=U.querySelector("#filter-wifi"),O=U.querySelector("#filter-dishwasher"),P=U.querySelector("#filter-parking"),W=U.querySelector("#filter-washer"),H=U.querySelector("#filter-elevator"),B=U.querySelector("#filter-conditioner"),G=U.querySelectorAll(".map__checkbox"),J=U.querySelector("#housing-type"),K=U.querySelector("#housing-price"),Q=U.querySelector("#housing-rooms"),X=U.querySelector("#housing-guests");let Y=[];function Z(e,t){Y=[],Y=function(e,t){return Y=function(e){let t=0;if("any"===J.value)return e;for(let r=0;r<e.length;r++)if(e[r].offer.type===J.value&&(Y.push(e[r]),t++),t>=j)return Y;return Y}(e),Y=function(e){if(Y=[],"any"===K.value)return e;for(let t=0;t<e.length;t++)e[t].offer.price>=R[K.value].min&&e[t].offer.price<R[K.value].max&&Y.push(e[t]);return Y}(Y),Y=function(e){Y=[];let t=0;if("any"===Q.value)return e;for(let r=0;r<e.length;r++)if(e[r].offer.rooms===Number(Q.value)&&(Y.push(e[r]),t++),t>=j)return Y;return Y}(Y),Y=function(e){Y=[];let t=0;if("any"===X.value)return e;for(let r=0;r<e.length;r++)if(e[r].offer.guests===Number(X.value)&&(Y.push(e[r]),t++),t>=j)return Y;return Y}(Y),Y=function(e){return I.checked||O.checked||P.checked||W.checked||H.checked||B.checked?(Y=function(e){if(I.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"wifi"===e))&&Y.push(e[t]);return Y}return e}(function(e){if(O.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"dishwasher"===e))&&Y.push(e[t]);return Y}return e}(function(e){if(P.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"parking"===e))&&Y.push(e[t]);return Y}return e}(function(e){if(W.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"washer"===e))&&Y.push(e[t]);return Y}return e}(function(e){if(H.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"elevator"===e))&&Y.push(e[t]);return Y}return e}(function(e){if(B.checked){Y=[];for(let t=0;t<Math.min(e.length,j);t++)e[t].offer.features.some((e=>"conditioner"===e))&&Y.push(e[t]);return Y}return e}(e)))))),Y):e}(Y),Y}(t),w.forEach((e=>{k.removeLayer(e)})),T(Y)}function ee(){I.checked=!1,O.checked=!1,P.checked=!1,W.checked=!1,H.checked=!1,B.checked=!1,J.value="any",K.value="any",Q.value="any",X.value="any"}const te={palace:1e4,flat:1e3,house:5e3,bungalow:0},re={1:[1],2:[1,2],3:[1,2,3],4:[1,2,3,4],100:[0]},ne=document.querySelector("#type"),oe=document.querySelector("#price");function ce(){oe.min=te[ne.value],oe.placeholder=te[ne.value]}ne.addEventListener("change",(()=>{ce()}));const ae=document.querySelector("#timein"),se=document.querySelector("#timeout");function ie(e,t){e.value=t.value}ae.addEventListener("change",(()=>{ie(se,ae)})),se.addEventListener("change",(()=>{ie(ae,se)}));const ue=document.querySelector("#address");function de(e){ue.value=e.lat.toFixed(5)+", "+e.lng.toFixed(5)}const le=document.querySelector("#room_number"),fe=document.querySelector("#capacity");function pe(){const e=re[le.value].some((e=>e===parseInt(fe.value,10)));return e?fe.setCustomValidity(""):fe.setCustomValidity("Ошибка количества комнат!"),fe.reportValidity(),e}fe.addEventListener("input",(()=>{pe()})),le.addEventListener("input",(()=>{pe()}));const he=document.querySelector(".ad-form");function me(e){he.addEventListener("submit",(t=>function(e,t){var r;e.preventDefault(),pe()&&(r=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((e=>{e.ok?function(e){n("Form send Success \n start reset"),p("success"),he.reset(),ce(),ee(),$(),A(),T(e)}(t):(n("Form NOT send"),p("error"))})).catch((e=>{n(`${e}`)})))}(t,e)))}const ye=he.querySelector(".ad-form__reset");h.classList.add("ad-form--disabled"),m.forEach((e=>{S(e)})),y.classList.add("map__filters--disabled"),g.forEach((e=>{S(e)})),S(v),ce(),function(){let e=!1;return k=L.map("map-canvas").on("load",(()=>{e=!0})).setView(E,12),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(k),de(E),C.addTo(k),e}()&&(h.classList.remove("ad-form--disabled"),m.forEach((e=>{q(e)})),y.classList.remove("map__filters--disabled"),g.forEach((e=>{q(e)})),q(v)),fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();throw new Error(`Ошибка загрузки данных! \n Статус: ${e.status} \n Описание: ${e.statusText} \n Тип: ${e.type}`)})).then((e=>e)).catch((e=>(n(`${e}`),!1))).then((e=>{T(e.slice(0,10)),function(e){V.forEach((t=>{t.addEventListener("input",_.debounce((()=>Z(0,e)),500))})),G.forEach((t=>{t.addEventListener("change",_.debounce((()=>Z(0,e)),500))}))}(e),me(e),function(e){ye.addEventListener("click",(t=>{t.preventDefault(),he.reset(),ee(),$(),A(),T(e)}))}(e)}))})();
//# sourceMappingURL=main.bundle.js.map